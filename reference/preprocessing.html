

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Preprocessing &mdash; scikit-mobility  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Measures" href="measures.html" />
    <link rel="prev" title="Data Structures" href="data_structures.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html" class="icon icon-home"> scikit-mobility
          

          
            
            <img src="../_static/logo_skmob.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_structures.html">Data Structures</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="measures.html">Measures</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="privacy.html">Privacy</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scikit-mobility</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Preprocessing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/preprocessing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="preprocessing">
<h1>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this headline">¶</a></h1>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.preprocessing.filtering.filter" title="skmob.preprocessing.filtering.filter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">filtering.filter</span></code></a>(tdf[, max_speed_kmh, …])</p></td>
<td><p>Trajectory filtering.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.preprocessing.compression.compress" title="skmob.preprocessing.compression.compress"><code class="xref py py-obj docutils literal notranslate"><span class="pre">compression.compress</span></code></a>(tdf[, spatial_radius_km])</p></td>
<td><p>Trajectory compression.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.preprocessing.detection.stops" title="skmob.preprocessing.detection.stops"><code class="xref py py-obj docutils literal notranslate"><span class="pre">detection.stops</span></code></a>(tdf[, stop_radius_factor, …])</p></td>
<td><p>Stops detection.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.preprocessing.clustering.cluster" title="skmob.preprocessing.clustering.cluster"><code class="xref py py-obj docutils literal notranslate"><span class="pre">clustering.cluster</span></code></a>(tdf[, cluster_radius_km, …])</p></td>
<td><p>Clustering of locations.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.preprocessing.routing.route" title="skmob.preprocessing.routing.route"><code class="xref py py-obj docutils literal notranslate"><span class="pre">routing.route</span></code></a>(tdf[, G, index_origin, …])</p></td>
<td><p>Routing.</p></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="skmob.preprocessing.filtering.filter">
<code class="sig-prename descclassname">skmob.preprocessing.filtering.</code><code class="sig-name descname">filter</code><span class="sig-paren">(</span><em class="sig-param">tdf</em>, <em class="sig-param">max_speed_kmh=500.0</em>, <em class="sig-param">include_loops=False</em>, <em class="sig-param">speed_kmh=5.0</em>, <em class="sig-param">max_loop=6</em>, <em class="sig-param">ratio_max=0.25</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.filtering.filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Trajectory filtering.</p>
<p>For each individual in a TrajDataFrame, filter out the trajectory points that are considered noise or outliers <a class="reference internal" href="#id6" id="id1"><span>[Z2015]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the trajectories of the individuals.</p></li>
<li><p><strong>max_speed</strong> (<em>float, optional</em>) – delete a trajectory point if the speed (in km/h) from the previous point is higher than <cite>max_speed_kmh</cite>. The default is <cite>500.0</cite>.</p></li>
<li><p><strong>include_loops</strong> (<em>boolean, optional</em>) – If <cite>True</cite>, trajectory points belonging to short and fast “loops” are removed. Specifically, points are removed if within the next <cite>max_loop</cite> points the individual has come back to a distance (<cite>ratio_max</cite> * the maximum distance reached), AND the average speed (in km/h) is higher than <cite>speed</cite>. The default is <cite>False</cite>.</p></li>
<li><p><strong>speed</strong> (<em>float, optional</em>) – the default is 5km/h (walking speed).</p></li>
<li><p><strong>max_loop</strong> (<em>int, optional</em>) – the default is <cite>6</cite>.</p></li>
<li><p><strong>ratio_max</strong> (<em>float, optional</em>) – the default is <cite>0.25</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the TrajDataFrame without the trajectory points that have been filtered out.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>if <cite>include_loops</cite> is <cite>True</cite>, the filter is very slow. Use only if raw data is really noisy.</p>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="z2015"><span class="brackets">Z2015</span></dt>
<dd><p>Zheng, Y. (2015) Trajectory data mining: an overview. ACM Transactions on Intelligent Systems and Technology 6(3), <a class="reference external" href="https://dl.acm.org/citation.cfm?id=2743025">https://dl.acm.org/citation.cfm?id=2743025</a></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="skmob.preprocessing.compression.compress">
<code class="sig-prename descclassname">skmob.preprocessing.compression.</code><code class="sig-name descname">compress</code><span class="sig-paren">(</span><em class="sig-param">tdf</em>, <em class="sig-param">spatial_radius_km=0.2</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.compression.compress" title="Permalink to this definition">¶</a></dt>
<dd><p>Trajectory compression.</p>
<p>Reduce the number of points in a trajectory for each individual in a TrajDataFrame. All points within a radius of <cite>spatial_radius_km</cite> kilometers from a given initial point are compressed into a single point that has the median coordinates of all points and the time of the initial point <a class="reference internal" href="#id6" id="id2"><span>[Z2015]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the input trajectories of the individuals.</p></li>
<li><p><strong>spatial_radius_km</strong> (<em>float, optional</em>) – the minimum distance (in km) between points of the compressed trajectory. The default is <cite>0.2</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the compressed TrajDataFrame.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="id3"><span class="brackets">Z2015</span></dt>
<dd><p>Zheng, Y. (2015) Trajectory data mining: an overview. ACM Transactions on Intelligent Systems and Technology 6(3), <a class="reference external" href="https://dl.acm.org/citation.cfm?id=2743025">https://dl.acm.org/citation.cfm?id=2743025</a></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="skmob.preprocessing.detection.stops">
<code class="sig-prename descclassname">skmob.preprocessing.detection.</code><code class="sig-name descname">stops</code><span class="sig-paren">(</span><em class="sig-param">tdf</em>, <em class="sig-param">stop_radius_factor=0.5</em>, <em class="sig-param">minutes_for_a_stop=20.0</em>, <em class="sig-param">spatial_radius_km=0.2</em>, <em class="sig-param">leaving_time=True</em>, <em class="sig-param">no_data_for_minutes=1000000000000.0</em>, <em class="sig-param">min_speed_kmh=None</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.detection.stops" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops detection.</p>
<p>Detect the stops for each individual in a TrajDataFrame. A stop is detected when the individual spends at least <cite>minutes_for_a_stop</cite> minutes within a distance <cite>stop_radius_factor * spatial_radius</cite> km from a given trajectory point. The stop’s coordinates are the median latitude and longitude values of the points found within the specified distance <a class="reference internal" href="#id9" id="id4"><span>[RT2004]</span></a> <a class="reference internal" href="#id6" id="id5"><span>[Z2015]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the input trajectories of the individuals.</p></li>
<li><p><strong>stop_radius_factor</strong> (<em>float, optional</em>) – the radius of the ball enclosing all trajectory points within the stop location. The default is <cite>0.5</cite>.</p></li>
<li><p><strong>minutes_for_a_stop</strong> (<em>float, optional</em>) – the minimum stop duration, in minutes. The default is <cite>20.0</cite>.</p></li>
<li><p><strong>spatial_radius_km</strong> (<em>float or None, optional</em>) – if <cite>None</cite>, use the spatial_radius specified in the TrajDataFrame properties (assigned by a <cite>preprocessing.compression</cite> function). The default is <cite>0.2</cite>.</p></li>
<li><p><strong>leaving_time</strong> (<em>boolean, optional</em>) – if <cite>True</cite>, a new column ‘leaving_datetime’ is added with the departure time from the stop location. The default is <cite>True</cite>.</p></li>
<li><p><strong>no_data_for_minutes</strong> (<em>float, optional</em>) – if the number of minutes between two consecutive points is larger than <cite>no_data_for_minutes</cite>,
then this is interpreted as missing data and does not count as a stop. The default is <cite>1e12</cite>.</p></li>
<li><p><strong>min_speed_kmh</strong> (<em>float or None, optional</em>) – if not <cite>None</cite>, remove the points at the end of a stop if their speed is larger than <cite>min_speed_kmh</cite> km/h. The default is <cite>None</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a TrajDataFrame with the coordinates (latitude, longitude) of the stop locations.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="rt2004"><span class="brackets">RT2004</span></dt>
<dd><p>Ramaswamy, H. &amp; Toyama, K. (2004) Project Lachesis: parsing and modeling location histories. In International Conference on Geographic Information Science, 106-124, <a class="reference external" href="http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf">http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf</a></p>
</dd>
<dt class="label" id="id6"><span class="brackets">Z2015</span></dt>
<dd><p>Zheng, Y. (2015) Trajectory data mining: an overview. ACM Transactions on Intelligent Systems and Technology 6(3), <a class="reference external" href="https://dl.acm.org/citation.cfm?id=2743025">https://dl.acm.org/citation.cfm?id=2743025</a></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="skmob.preprocessing.clustering.cluster">
<code class="sig-prename descclassname">skmob.preprocessing.clustering.</code><code class="sig-name descname">cluster</code><span class="sig-paren">(</span><em class="sig-param">tdf</em>, <em class="sig-param">cluster_radius_km=0.1</em>, <em class="sig-param">min_samples=1</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.clustering.cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Clustering of locations.</p>
<p>Cluster the stops of each individual in a TrajDataFrame. The stops correspond to visits to the same location at different times, based on spatial proximity <a class="reference internal" href="#id9" id="id7"><span>[RT2004]</span></a>. The clustering algorithm used is DBSCAN (by sklearn <a class="reference internal" href="#dbscan" id="id8"><span>[DBSCAN]</span></a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the input TrajDataFrame that should contain the stops, i.e., the output of a <cite>preprocessing.detection</cite> function.</p></li>
<li><p><strong>cluster_radius_km</strong> (<em>float, optional</em>) – the parameter <cite>eps</cite> of the function sklearn.cluster.DBSCAN, in kilometers. The default is <cite>0.1</cite>.</p></li>
<li><p><strong>min_samples</strong> (<em>int, optional</em>) – the parameter <cite>min_samples</cite> of the function sklearn.cluster.DBSCAN indicating the minimum number of stops to form a cluster. The default is <cite>1</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a TrajDataFrame with the additional column ‘cluster’ containing the cluster labels. The stops that belong to the same cluster have the same label. The labels are integers corresponding to the ranks of clusters according to the frequency of visitation (the most visited cluster has label 0, the second most visited has label 1, etc.).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="dbscan"><span class="brackets"><a class="fn-backref" href="#id8">DBSCAN</a></span></dt>
<dd><p>DBSCAN implementation, scikit-learn, <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html">https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html</a></p>
</dd>
<dt class="label" id="id9"><span class="brackets">RT2004</span></dt>
<dd><p>Ramaswamy, H. &amp; Toyama, K. (2004) Project Lachesis: parsing and modeling location histories. In International Conference on Geographic Information Science, 106-124, <a class="reference external" href="http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf">http://kentarotoyama.com/papers/Hariharan_2004_Project_Lachesis.pdf</a></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="skmob.preprocessing.routing.route">
<code class="sig-prename descclassname">skmob.preprocessing.routing.</code><code class="sig-name descname">route</code><span class="sig-paren">(</span><em class="sig-param">tdf</em>, <em class="sig-param">G=None</em>, <em class="sig-param">index_origin=0</em>, <em class="sig-param">index_destin=-1</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.preprocessing.routing.route" title="Permalink to this definition">¶</a></dt>
<dd><p>Routing.</p>
<p>Create a route on Google Maps between two locations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tdf</strong> (<em>TrajDataFrame</em>) – the TrajDataFrame with the locations</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>G, shortest_route = route(tdf)</p>
<p>m = ox.plot_route_folium(G, shortest_route, route_color=’green’)</p>
<p>origin_coords = tuple(tdf1.iloc[0][[‘lat’, ‘lng’]].values)
destin_coords = tuple(tdf1.iloc[-1][[‘lat’, ‘lng’]].values)</p>
<dl class="simple">
<dt>folium.Marker(location=origin_coords,</dt><dd><p>icon=folium.Icon(color=’red’)).add_to(m)</p>
</dd>
<dt>folium.Marker(location=destin_coords,</dt><dd><p>icon=folium.Icon(color=’blue’)).add_to(m)</p>
</dd>
</dl>
<p>tdf1.plot_trajectory(map_f=m)</p>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="measures.html" class="btn btn-neutral float-right" title="Measures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data_structures.html" class="btn btn-neutral float-left" title="Data Structures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, skmob devs

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>