

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Models &mdash; scikit-mobility  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Input/Output" href="io.html" />
    <link rel="prev" title="Evaluation measures" href="evaluation_measures.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html" class="icon icon-home"> scikit-mobility
          

          
            
            <img src="../_static/logo_skmob.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_structures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="measures.html">Measures</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.epr">EPR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.markov_diary_generator">Markov Diary Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.gravity">Gravity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-skmob.models.radiation">Radiation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="io.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="privacy.html">Privacy</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scikit-mobility</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/models.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="models">
<h1>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h1>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.models.epr.DensityEPR" title="skmob.models.epr.DensityEPR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epr.DensityEPR</span></code></a>([name, rho, gamma, beta, …])</p></td>
<td><p>Density-EPR model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.models.epr.SpatialEPR" title="skmob.models.epr.SpatialEPR"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epr.SpatialEPR</span></code></a>([name, rho, gamma, beta, …])</p></td>
<td><p>Spatial-EPR model.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.models.epr.Ditras" title="skmob.models.epr.Ditras"><code class="xref py py-obj docutils literal notranslate"><span class="pre">epr.Ditras</span></code></a>(diary_generator[, name, rho, gamma])</p></td>
<td><p>Ditras modelling framework.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator" title="skmob.models.markov_diary_generator.MarkovDiaryGenerator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">markov_diary_generator.MarkovDiaryGenerator</span></code></a>([name])</p></td>
<td><p>The Markov model which describes the probability that an individual follows her routine and visits a typical location at the usual time, or she breaks the routine and visits another location.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#skmob.models.gravity.Gravity" title="skmob.models.gravity.Gravity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gravity.Gravity</span></code></a>([deterrence_func_type, …])</p></td>
<td><p>Gravity model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#skmob.models.radiation.Radiation" title="skmob.models.radiation.Radiation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">radiation.Radiation</span></code></a>([name])</p></td>
<td><p>The radiation model for human migration.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="module-skmob.models.epr">
<span id="epr"></span><h2>EPR<a class="headerlink" href="#module-skmob.models.epr" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="skmob.models.epr.DensityEPR">
<em class="property">class </em><code class="sig-prename descclassname">skmob.models.epr.</code><code class="sig-name descname">DensityEPR</code><span class="sig-paren">(</span><em class="sig-param">name='Density EPR model'</em>, <em class="sig-param">rho=0.6</em>, <em class="sig-param">gamma=0.21</em>, <em class="sig-param">beta=0.8</em>, <em class="sig-param">tau=17</em>, <em class="sig-param">min_wait_time_minutes=20</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.DensityEPR" title="Permalink to this definition">¶</a></dt>
<dd><p>Density-EPR model.</p>
<p>The d-EPR model of individual human mobility consists of the following mechanisms <a class="reference internal" href="#psrpgb2015" id="id1"><span>[PSRPGB2015]</span></a> <a class="reference internal" href="#psr2016" id="id2"><span>[PSR2016]</span></a>:</p>
<p><strong>Waiting time choice</strong>. The waiting time <span class="math notranslate nohighlight">\(\Delta t\)</span> between two movements of the agent is chosen randomly from the distribution <span class="math notranslate nohighlight">\(P(\Delta t) \sim \Delta t^{−1 −\beta} \exp(−\Delta t/ \tau)\)</span>. Parameters <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\tau\)</span> correspond to arguments <cite>beta</cite> and <cite>tau</cite> of the constructor, respectively.</p>
<p><strong>Action selection</strong>. With probability <span class="math notranslate nohighlight">\(P_{new}=\rho S^{-\gamma}\)</span>, where <span class="math notranslate nohighlight">\(S\)</span> is the number of distinct locations previously visited by the agent, the agent visits a new location (Exploration phase), otherwise it returns to a previously visited location (Return phase). Parameters <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span> correspond to arguments <cite>rho</cite> and <cite>gamma</cite> of the constructor, respectively.</p>
<p><strong>Exploration phase</strong>. If the agent that is currently in location <span class="math notranslate nohighlight">\(i\)</span> explores a new location, then the new location <span class="math notranslate nohighlight">\(j \neq i\)</span> is selected according to the gravity model with probability <span class="math notranslate nohighlight">\(p_{ij} = \frac{1}{N} \frac{n_i n_j}{r_{ij}^2}\)</span>, where <span class="math notranslate nohighlight">\(n_{i (j)}\)</span> is the location’s relevance, that is, the probability of a population to visit location <span class="math notranslate nohighlight">\(i(j)\)</span>, <span class="math notranslate nohighlight">\(r_{ij}\)</span> is the geographic distance between <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, and <span class="math notranslate nohighlight">\(N = \sum_{i, j \neq i} p_{ij}\)</span> is a normalization constant. The number of distinct locations visited, <span class="math notranslate nohighlight">\(S\)</span>, is increased by 1.</p>
<p><strong>Return phase</strong>. If the individual returns to a previously visited location, such a location <span class="math notranslate nohighlight">\(i\)</span> is chosen with probability proportional to the number of time the agent visited <span class="math notranslate nohighlight">\(i\)</span>, i.e., <span class="math notranslate nohighlight">\(\Pi_i = f_i\)</span>, where <span class="math notranslate nohighlight">\(f_i\)</span> is the visitation frequency of location <span class="math notranslate nohighlight">\(i\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the d-EPR model. The default value is “Density EPR model”.</p></li>
<li><p><strong>rho</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\rho \in (0, 1]\)</span> in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\rho = 0.6\)</span> <a class="reference internal" href="#skwb2010" id="id3"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>gamma</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\gamma\)</span> (<span class="math notranslate nohighlight">\(\gamma \geq 0\)</span>) in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\gamma=0.21\)</span> <a class="reference internal" href="#skwb2010" id="id4"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>beta</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\beta\)</span> of the waiting time distribution in the Waiting time choice mechanism. The default value is <span class="math notranslate nohighlight">\(\beta=0.8\)</span> <a class="reference internal" href="#skwb2010" id="id5"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>tau</strong> (<em>int, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\tau\)</span> of the waiting time distribution in the Waiting time choice mechanism. The default value is <span class="math notranslate nohighlight">\(\tau = 17\)</span>, expressed in hours <a class="reference internal" href="#skwb2010" id="id6"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – minimum waiting time between two movements, in minutes.</p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the model.</p></li>
<li><p><strong>rho</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\rho\)</span>.</p></li>
<li><p><strong>gamma</strong> (<em>float</em>) – the input parameters <span class="math notranslate nohighlight">\(\gamma\)</span>.</p></li>
<li><p><strong>beta</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\beta\)</span>.</p></li>
<li><p><strong>tau</strong> (<em>int</em>) – the input parameter <span class="math notranslate nohighlight">\(\tau\)</span>.</p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – the input parameters <cite>min_wait_time_minutes</cite>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.epr</span> <span class="kn">import</span> <span class="n">DensityEPR</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/scikit-mobility/scikit-mobility/master/tutorial/data/NY_counties_2011.geojson&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/14 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/14 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">depr</span> <span class="o">=</span> <span class="n">DensityEPR</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">depr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="n">n_agents</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">   uid                   datetime        lat        lng</span>
<span class="go">0    1 2019-01-01 08:00:00.000000  42.780819 -76.823724</span>
<span class="go">1    1 2019-01-01 09:45:58.388540  42.728060 -77.775510</span>
<span class="go">2    1 2019-01-01 10:16:09.406408  42.780819 -76.823724</span>
<span class="go">3    1 2019-01-01 17:13:39.999037  42.852827 -77.299810</span>
<span class="go">4    1 2019-01-01 19:24:27.353379  42.728060 -77.775510</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;model&#39;: {&#39;class&#39;: &lt;function DensityEPR.__init__ at 0x7f548a49cf28&gt;, &#39;generate&#39;: {&#39;start_date&#39;: Timestamp(&#39;2019-01-01 08:00:00&#39;), &#39;end_date&#39;: Timestamp(&#39;2019-01-14 08:00:00&#39;), &#39;gravity_singly&#39;: {}, &#39;n_agents&#39;: 100, &#39;relevance_column&#39;: &#39;population&#39;, &#39;random_state&#39;: None, &#39;verbose&#39;: True}}}</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="psrpgb2015"><span class="brackets">PSRPGB2015</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id7">2</a>)</span></dt>
<dd><p>Pappalardo, L., Simini, F. Rinzivillo, S., Pedreschi, D. Giannotti, F. &amp; Barabasi, A. L. (2015) Returners and Explorers dichotomy in human mobility. Nature Communications 6, <a class="reference external" href="https://www.nature.com/articles/ncomms9166">https://www.nature.com/articles/ncomms9166</a></p>
</dd>
<dt class="label" id="psr2016"><span class="brackets">PSR2016</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id8">2</a>)</span></dt>
<dd><p>Pappalardo, L., Simini, F. Rinzivillo, S. (2016) Human Mobility Modelling: exploration and preferential return meet the gravity model. Procedia Computer Science 83, <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1877050916302216">https://www.sciencedirect.com/science/article/pii/S1877050916302216</a></p>
</dd>
<dt class="label" id="skwb2010"><span class="brackets">SKWB2010</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>,<a href="#id5">3</a>,<a href="#id6">4</a>,<a href="#id9">5</a>,<a href="#id10">6</a>,<a href="#id11">7</a>,<a href="#id13">8</a>,<a href="#id14">9</a>)</span></dt>
<dd><p>Song, C., Koren, T., Wang, P. &amp; Barabasi, A.L. (2010) Modelling the scaling properties of human mobility. Nature Physics 6, 818-823, <a class="reference external" href="https://www.nature.com/articles/nphys1760">https://www.nature.com/articles/nphys1760</a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">EPR</span></code>, <a class="reference internal" href="#skmob.models.epr.SpatialEPR" title="skmob.models.epr.SpatialEPR"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpatialEPR</span></code></a>, <a class="reference internal" href="#skmob.models.epr.Ditras" title="skmob.models.epr.Ditras"><code class="xref py py-class docutils literal notranslate"><span class="pre">Ditras</span></code></a></p>
</div>
<dl class="method">
<dt id="skmob.models.epr.DensityEPR.generate">
<code class="sig-name descname">generate</code><span class="sig-paren">(</span><em class="sig-param">start_date</em>, <em class="sig-param">end_date</em>, <em class="sig-param">spatial_tessellation</em>, <em class="sig-param">gravity_singly={}</em>, <em class="sig-param">n_agents=1</em>, <em class="sig-param">starting_locations=None</em>, <em class="sig-param">od_matrix=None</em>, <em class="sig-param">relevance_column='relevance'</em>, <em class="sig-param">random_state=None</em>, <em class="sig-param">log_file=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.DensityEPR.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of a set of agents at time <cite>start_date</cite> till time <cite>end_date</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>) – the starting date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>end_date</strong> (<em>datetime</em>) – the ending date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>spatial_tessellation</strong> (<em>geopandas GeoDataFrame</em>) – the spatial tessellation, i.e., a division of the territory in locations.</p></li>
<li><p><strong>gravity_singly</strong> (<em>{} or Gravity, optional</em>) – the gravity model (singly constrained or doubly constrained) to use when generating the probability to move between two locations (note, used by DensityEPR). The default is “{}”.</p></li>
<li><p><strong>n_agents</strong> (<em>int, optional</em>) – the number of agents to generate. The default is 1.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the name of the column in <cite>spatial_tessellation</cite> to use as relevance variable. The default is “relevance”.</p></li>
<li><p><strong>starting_locations</strong> (<em>list or None, optional</em>) – a list of integers, each identifying the location from which to start the simulation of each agent. Note that, if <cite>starting_locations</cite> is not None, its length must be equal to the value of <cite>n_agents</cite>, i.e., you must specify one starting location per agent. The default is None.</p></li>
<li><p><strong>od_matrix</strong> (<em>numpy array or None, optional</em>) – the origin destination matrix to use for deciding the movements of the agent. If <cite>None</cite>, it is computed “on the fly” during the simulation. The default is None.</p></li>
<li><p><strong>random_state</strong> (<em>int or None, optional</em>) – if int, it is the seed used by the random number generator; if None, the random number generator is the RandomState instance used by np.random and random.random. The default is None.</p></li>
<li><p><strong>log_file</strong> (<em>str or None, optional</em>) – the name of the file where to write a log of the execution of the model. The logfile will contain all decisions (returns or explorations) made by the model. The default is None.</p></li>
<li><p><strong>verbose</strong> (<em>boolean, optional</em>) – if True, show a progress bar. The default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the synthetic trajectories generated by the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="skmob.models.epr.SpatialEPR">
<em class="property">class </em><code class="sig-prename descclassname">skmob.models.epr.</code><code class="sig-name descname">SpatialEPR</code><span class="sig-paren">(</span><em class="sig-param">name='Spatial EPR model'</em>, <em class="sig-param">rho=0.6</em>, <em class="sig-param">gamma=0.21</em>, <em class="sig-param">beta=0.8</em>, <em class="sig-param">tau=17</em>, <em class="sig-param">min_wait_time_minutes=20</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.SpatialEPR" title="Permalink to this definition">¶</a></dt>
<dd><p>Spatial-EPR model.</p>
<p>The s-EPR model of individual human mobility consists of the following mechanisms <a class="reference internal" href="#psrpgb2015" id="id7"><span>[PSRPGB2015]</span></a> <a class="reference internal" href="#psr2016" id="id8"><span>[PSR2016]</span></a> <a class="reference internal" href="#skwb2010" id="id9"><span>[SKWB2010]</span></a>:</p>
<p><strong>Waiting time choice</strong>. The waiting time <span class="math notranslate nohighlight">\(\Delta t\)</span> between two movements of the agent is chosen randomly from the distribution <span class="math notranslate nohighlight">\(P(\Delta t) \sim \Delta t^{−1 −\beta} \exp(−\Delta t/ \tau)\)</span>. Parameters <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\tau\)</span> correspond to arguments <cite>beta</cite> and <cite>tau</cite> of the constructor, respectively.</p>
<p><strong>Action selection</strong>. With probability <span class="math notranslate nohighlight">\(P_{new}=\rho S^{-\gamma}\)</span>, where <span class="math notranslate nohighlight">\(S\)</span> is the number of distinct locations previously visited by the agent, the agent visits a new location (Exploration phase), otherwise it returns to a previously visited location (Return phase). Parameters <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span> correspond to arguments <cite>rho</cite> and <cite>gamma</cite> of the constructor, respectively.</p>
<p><strong>Exploration phase</strong>. If the agent that is currently in location <span class="math notranslate nohighlight">\(i\)</span> explores a new location, then the new location <span class="math notranslate nohighlight">\(j \neq i\)</span> is selected according to the distance from the current location <span class="math notranslate nohighlight">\(p_{ij} = \frac{1}{r_{ij}^2}\)</span>, where <span class="math notranslate nohighlight">\(r_{ij}\)</span> is the geographic distance between <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>. The number of distinct locations visited, <span class="math notranslate nohighlight">\(S\)</span>, is increased by 1.</p>
<p><strong>Return phase</strong>. If the individual returns to a previously visited location, such a location <span class="math notranslate nohighlight">\(i\)</span> is chosen with probability proportional to the number of time the agent visited <span class="math notranslate nohighlight">\(i\)</span>, i.e., <span class="math notranslate nohighlight">\(\Pi_i = f_i\)</span>, where <span class="math notranslate nohighlight">\(f_i\)</span> is the visitation frequency of location <span class="math notranslate nohighlight">\(i\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the s-EPR model. The default value is “Spatial EPR model”.</p></li>
<li><p><strong>rho</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\rho \in (0, 1]\)</span> in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\rho = 0.6\)</span> <a class="reference internal" href="#skwb2010" id="id10"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>gamma</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\gamma\)</span> (<span class="math notranslate nohighlight">\(\gamma \geq 0\)</span>) in the Action selection mechanism <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\gamma=0.21\)</span> <a class="reference internal" href="#skwb2010" id="id11"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>beta</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\beta\)</span></p></li>
<li><p><strong>tau</strong> (<em>int</em>) – the input parameter <span class="math notranslate nohighlight">\(\tau\)</span></p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – the input parameters <cite>min_wait_time_minutes</cite></p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the model.</p></li>
<li><p><strong>rho</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\rho\)</span>.</p></li>
<li><p><strong>gamma</strong> (<em>float</em>) – the input parameters <span class="math notranslate nohighlight">\(\gamma\)</span>.</p></li>
<li><p><strong>beta</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\beta\)</span>.</p></li>
<li><p><strong>tau</strong> (<em>int</em>) – the input parameter <span class="math notranslate nohighlight">\(\tau\)</span>.</p></li>
<li><p><strong>min_wait_time_minutes</strong> (<em>int</em>) – the input parameters <cite>min_wait_time_minutes</cite>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.epr</span> <span class="kn">import</span> <span class="n">SpatialEPR</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/scikit-mobility/scikit-mobility/master/tutorial/data/NY_counties_2011.geojson&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/14 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sepr</span> <span class="o">=</span> <span class="n">SpatialEPR</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">sepr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">n_agents</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">   uid                   datetime        lat        lng</span>
<span class="go">0    1 2019-01-01 08:00:00.000000  42.267915 -77.383591</span>
<span class="go">1    1 2019-01-01 13:06:13.973868  42.633510 -77.105324</span>
<span class="go">2    1 2019-01-01 14:17:41.188668  42.452018 -76.473618</span>
<span class="go">3    1 2019-01-01 14:49:30.896248  42.633510 -77.105324</span>
<span class="go">4    1 2019-01-01 15:10:54.133150  43.382528 -78.230656</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;model&#39;: {&#39;class&#39;: &lt;function SpatialEPR.__init__ at 0x7f548a49e048&gt;, &#39;generate&#39;: {&#39;start_date&#39;: Timestamp(&#39;2019-01-01 08:00:00&#39;), &#39;end_date&#39;: Timestamp(&#39;2019-01-14 08:00:00&#39;), &#39;gravity_singly&#39;: {}, &#39;n_agents&#39;: 100, &#39;relevance_column&#39;: None, &#39;random_state&#39;: None, &#39;verbose&#39;: True}}}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">EPR</span></code>, <a class="reference internal" href="#skmob.models.epr.DensityEPR" title="skmob.models.epr.DensityEPR"><code class="xref py py-class docutils literal notranslate"><span class="pre">DensityEPR</span></code></a>, <a class="reference internal" href="#skmob.models.epr.Ditras" title="skmob.models.epr.Ditras"><code class="xref py py-class docutils literal notranslate"><span class="pre">Ditras</span></code></a></p>
</div>
<dl class="method">
<dt id="skmob.models.epr.SpatialEPR.generate">
<code class="sig-name descname">generate</code><span class="sig-paren">(</span><em class="sig-param">start_date</em>, <em class="sig-param">end_date</em>, <em class="sig-param">spatial_tessellation</em>, <em class="sig-param">gravity_singly={}</em>, <em class="sig-param">n_agents=1</em>, <em class="sig-param">starting_locations=None</em>, <em class="sig-param">od_matrix=None</em>, <em class="sig-param">random_state=None</em>, <em class="sig-param">log_file=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.SpatialEPR.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of a set of agents at time <cite>start_date</cite> till time <cite>end_date</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>) – the starting date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>end_date</strong> (<em>datetime</em>) – the ending date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>spatial_tessellation</strong> (<em>geopandas GeoDataFrame</em>) – the spatial tessellation, i.e., a division of the territory in locations.</p></li>
<li><p><strong>gravity_singly</strong> (<em>{} or Gravity, optional</em>) – the gravity model (singly constrained or doubly constrained) to use when generating the probability to move between two locations (note, used by DensityEPR). The default is “{}”.</p></li>
<li><p><strong>n_agents</strong> (<em>int, optional</em>) – the number of agents to generate. The default is 1.</p></li>
<li><p><strong>starting_locations</strong> (<em>list or None, optional</em>) – a list of integers, each identifying the location from which to start the simulation of each agent. Note that, if <cite>starting_locations</cite> is not None, its length must be equal to the value of <cite>n_agents</cite>, i.e., you must specify one starting location per agent. The default is None.</p></li>
<li><p><strong>od_matrix</strong> (<em>numpy array or None, optional</em>) – the origin destination matrix to use for deciding the movements of the agent. If <cite>None</cite>, it is computed “on the fly” during the simulation. The default is None.</p></li>
<li><p><strong>random_state</strong> (<em>int or None, optional</em>) – if int, it is the seed used by the random number generator; if None, the random number generator is the RandomState instance used by np.random and random.random. The default is None.</p></li>
<li><p><strong>log_file</strong> (<em>str or None, optional</em>) – the name of the file where to write a log of the execution of the model. The logfile will contain all decisions (returns or explorations) made by the model. The default is None.</p></li>
<li><p><strong>verbose</strong> (<em>boolean, optional</em>) – if True, show a progress bar. The default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the synthetic trajectories generated by the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="skmob.models.epr.Ditras">
<em class="property">class </em><code class="sig-prename descclassname">skmob.models.epr.</code><code class="sig-name descname">Ditras</code><span class="sig-paren">(</span><em class="sig-param">diary_generator</em>, <em class="sig-param">name='Ditras model'</em>, <em class="sig-param">rho=0.3</em>, <em class="sig-param">gamma=0.21</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.Ditras" title="Permalink to this definition">¶</a></dt>
<dd><p>Ditras modelling framework.</p>
<p>The DITRAS (DIary-based TRAjectory Simulator) modelling framework to simulate the spatio-temporal patterns of human mobility <a class="reference internal" href="#ps2018" id="id12"><span>[PS2018]</span></a>. DITRAS consists of two phases:</p>
<p><strong>Mobility Diary Generation</strong>. In the first phase, DITRAS generates a <em>mobility diary</em> which captures the temporal patterns of human mobility.</p>
<p><strong>Trajectory Generation</strong>. In the second phase, DITRAS transforms the mobility diary into a mobility trajectory which captures the spatial patterns of human movements.</p>
<img alt="https://raw.githubusercontent.com/jonpappalord/DITRAS/master/DITRAS_schema.png" src="https://raw.githubusercontent.com/jonpappalord/DITRAS/master/DITRAS_schema.png" />
<p><strong>Outline of the DITRAS framework</strong>. DITRAS combines two probabilistic models: a diary generator (e.g., <span class="math notranslate nohighlight">\(MD(t)\)</span>) and trajectory generator (e.g., d-EPR). The diary generator produces a mobility diary <span class="math notranslate nohighlight">\(D\)</span>. The mobility diary <span class="math notranslate nohighlight">\(D\)</span> is the input of the trajectory generator together with a weighted spatial tessellation of the territory <span class="math notranslate nohighlight">\(L\)</span>. From <span class="math notranslate nohighlight">\(D\)</span> and <span class="math notranslate nohighlight">\(L\)</span> the trajectory generator produces a synthetic mobility trajectory <span class="math notranslate nohighlight">\(S\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>diary_generator</strong> (<em>MarkovDiaryGenerator</em>) – the diary generator to use for generating the diary.</p></li>
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the Ditras model. The default value is “Ditras”.</p></li>
<li><p><strong>rho</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\rho \in (0, 1]\)</span> in the Action selection mechanism  of the DensityEPR model <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\rho = 0.6\)</span> <a class="reference internal" href="#skwb2010" id="id13"><span>[SKWB2010]</span></a>.</p></li>
<li><p><strong>gamma</strong> (<em>float, optional</em>) – it corresponds to the parameter <span class="math notranslate nohighlight">\(\gamma\)</span> (<span class="math notranslate nohighlight">\(\gamma \geq 0\)</span>) in the Action selection mechanism of the DensityEPR model <span class="math notranslate nohighlight">\(P_{new} = \rho S^{-\gamma}\)</span> and controls the agent’s tendency to explore a new location during the next move versus returning to a previously visited location. The default value is <span class="math notranslate nohighlight">\(\gamma=0.21\)</span> <a class="reference internal" href="#skwb2010" id="id14"><span>[SKWB2010]</span></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>diary_generator</strong> (<a class="reference internal" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator" title="skmob.models.markov_diary_generator.MarkovDiaryGenerator"><em>MarkovDiaryGenerator</em></a>) – the diary generator to use for generating the diary <a class="reference internal" href="#ps2018" id="id15"><span>[PS2018]</span></a>.</p></li>
<li><p><strong>name</strong> (<em>str</em>) – the name of the instantiation of the model.</p></li>
<li><p><strong>rho</strong> (<em>float</em>) – the input parameter <span class="math notranslate nohighlight">\(\rho\)</span>.</p></li>
<li><p><strong>gamma</strong> (<em>float</em>) – the input parameters <span class="math notranslate nohighlight">\(\gamma\)</span>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.epr</span> <span class="kn">import</span> <span class="n">Ditras</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models.markov_diary_generator</span> <span class="kn">import</span> <span class="n">MarkovDiaryGenerator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.preprocessing</span> <span class="kn">import</span> <span class="n">filtering</span><span class="p">,</span> <span class="n">compression</span><span class="p">,</span> <span class="n">detection</span><span class="p">,</span> <span class="n">clustering</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load and preprocess data to train the MarkovDiaryGenerator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/scikit-mobility/scikit-mobility/master/tutorial/data/geolife_sample.txt.gz&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">TrajDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctdf</span> <span class="o">=</span> <span class="n">compression</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">tdf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stdf</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">stops</span><span class="p">(</span><span class="n">ctdf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cstdf</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">stdf</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># instantiate and train the MarkovDiaryGenerator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mdg</span> <span class="o">=</span> <span class="n">MarkovDiaryGenerator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mdg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cstdf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lid</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># set start time, end time and tessellation for the simulation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/01 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2019/01/14 08:00:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;data/NY_counties_2011.geojson&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># instantiate the model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ditras</span> <span class="o">=</span> <span class="n">Ditras</span><span class="p">(</span><span class="n">mdg</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># run the model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ditras_tdf</span> <span class="o">=</span> <span class="n">ditras</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tessellation</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">,</span>
<span class="go">                n_agents=3, od_matrix=None, verbose=True)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ditras_tdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">   uid            datetime        lat        lng</span>
<span class="go">0    1 2019-01-01 08:00:00  43.382528 -78.230656</span>
<span class="go">1    1 2019-01-02 03:00:00  43.309133 -77.680414</span>
<span class="go">2    1 2019-01-02 23:00:00  43.382528 -78.230656</span>
<span class="go">3    1 2019-01-03 10:00:00  43.382528 -78.230656</span>
<span class="go">4    1 2019-01-03 21:00:00  43.309133 -77.680414</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ditras_tdf</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="go">{&#39;model&#39;: {&#39;class&#39;: &lt;function Ditras.__init__ at 0x7f0cf0b7e158&gt;, &#39;generate&#39;: {&#39;start_date&#39;: Timestamp(&#39;2019-01-01 08:00:00&#39;), &#39;end_date&#39;: Timestamp(&#39;2019-01-14 08:00:00&#39;), &#39;gravity_singly&#39;: {}, &#39;n_agents&#39;: 3, &#39;relevance_column&#39;: &#39;population&#39;, &#39;random_state&#39;: None, &#39;verbose&#39;: True}}}</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="ps2018"><span class="brackets">PS2018</span><span class="fn-backref">(<a href="#id12">1</a>,<a href="#id15">2</a>)</span></dt>
<dd><p>Pappalardo, L. &amp; Simini, F. (2018) Data-driven generation of spatio-temporal routines in human mobility. Data Mining and Knowledge Discovery 32, 787-829, <a class="reference external" href="https://link.springer.com/article/10.1007/s10618-017-0548-4">https://link.springer.com/article/10.1007/s10618-017-0548-4</a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#skmob.models.epr.DensityEPR" title="skmob.models.epr.DensityEPR"><code class="xref py py-class docutils literal notranslate"><span class="pre">DensityEPR</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MarkovDiaryGenerator</span></code></p>
</div>
<dl class="method">
<dt id="skmob.models.epr.Ditras.generate">
<code class="sig-name descname">generate</code><span class="sig-paren">(</span><em class="sig-param">start_date</em>, <em class="sig-param">end_date</em>, <em class="sig-param">spatial_tessellation</em>, <em class="sig-param">gravity_singly={}</em>, <em class="sig-param">n_agents=1</em>, <em class="sig-param">starting_locations=None</em>, <em class="sig-param">od_matrix=None</em>, <em class="sig-param">relevance_column='relevance'</em>, <em class="sig-param">random_state=None</em>, <em class="sig-param">log_file=None</em>, <em class="sig-param">verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.epr.Ditras.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of a set of agents at time <cite>start_date</cite> till time <cite>end_date</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>) – the starting date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>end_date</strong> (<em>datetime</em>) – the ending date of the simulation, in “YYY/mm/dd HH:MM:SS” format.</p></li>
<li><p><strong>spatial_tessellation</strong> (<em>geopandas GeoDataFrame</em>) – the spatial tessellation, i.e., a division of the territory in locations.</p></li>
<li><p><strong>gravity_singly</strong> (<em>{} or Gravity, optional</em>) – the gravity model (singly constrained or doubly constrained) to use when generating the probability to move between two locations. The default is “{}”.</p></li>
<li><p><strong>n_agents</strong> (<em>int, optional</em>) – the number of agents to generate. The default is 1.</p></li>
<li><p><strong>starting_locations</strong> (<em>list or None, optional</em>) – a list of integers, each identifying the location from which to start the simulation of each agent. Note that, if <cite>starting_locations</cite> is not None, its length must be equal to the value of <cite>n_agents</cite>, i.e., you must specify one starting location per agent. The default is None.</p></li>
<li><p><strong>od_matrix</strong> (<em>numpy array or None, optional</em>) – the origin destination matrix to use for deciding the movements of the agent. If <cite>None</cite>, it is computed “on the fly” during the simulation. The default is None.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the name of the column in <cite>spatial_tessellation</cite> to use as relevance variable. The default is “relevance”.</p></li>
<li><p><strong>random_state</strong> (<em>int or None, optional</em>) – if int, it is the seed used by the random number generator; if None, the random number generator is the RandomState instance used by np.random and random.random. The default is None.</p></li>
<li><p><strong>log_file</strong> (<em>str or None, optional</em>) – the name of the file where to write a log of the execution of the model. The logfile will contain all decisions (returns or explorations) made by the model. The default is None.</p></li>
<li><p><strong>verbose</strong> (<em>boolean, optional</em>) – if True, show a progress bar. The default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the synthetic trajectories generated by the model</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.trajectorydataframe.TrajDataFrame" title="skmob.core.trajectorydataframe.TrajDataFrame">TrajDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-skmob.models.markov_diary_generator">
<span id="markov-diary-generator"></span><h2>Markov Diary Generator<a class="headerlink" href="#module-skmob.models.markov_diary_generator" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="skmob.models.markov_diary_generator.MarkovDiaryGenerator">
<em class="property">class </em><code class="sig-prename descclassname">skmob.models.markov_diary_generator.</code><code class="sig-name descname">MarkovDiaryGenerator</code><span class="sig-paren">(</span><em class="sig-param">name='Markov diary'</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>The Markov model which describes the probability that an individual follows her routine and visits a typical location
at the usual time, or she breaks the routine and visits another location.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – str
name of the object</p>
</dd>
<dt class="field-even">Ivar</dt>
<dd class="field-even"><p><a href="#id20"><span class="problematic" id="id21">markov_chain_</span></a>: dict
the trained markov chain</p>
</dd>
<dt class="field-odd">Variables</dt>
<dd class="field-odd"><p><strong>time_slot_length</strong> – str
length of the time slot (1h)</p>
</dd>
</dl>
<dl>
<dt>References:</dt><dd><dl class="citation">
<dt class="label" id="pappalardo2017data"><span class="brackets">pappalardo2017data</span></dt>
<dd><p>Pappalardo, L., Simini, F. “Data-driven generation of spatio-temporal routines in human mobility.”, Data Mining and Knowledge Discovery, 32:3, 2017.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="method">
<dt id="skmob.models.markov_diary_generator.MarkovDiaryGenerator.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param">traj</em>, <em class="sig-param">n_individuals</em>, <em class="sig-param">lid='location'</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a Markov chain diary based on the trajectories in input</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>traj</strong> (<em>pandas DataFrame</em>) – the trajectories of the individuals</p></li>
<li><p><strong>n_individuals</strong> – int
the number of individuals to consider</p></li>
<li><p><strong>start_date</strong> – datetime
the starting date</p></li>
<li><p><strong>end_date</strong> – datetime
the ending date</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="skmob.models.markov_diary_generator.MarkovDiaryGenerator.generate">
<code class="sig-name descname">generate</code><span class="sig-paren">(</span><em class="sig-param">diary_length</em>, <em class="sig-param">start_date</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.markov_diary_generator.MarkovDiaryGenerator.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of the mobility diary given the diary_length</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>diary_length</strong> – int
the length of the diary in the time unit of the MD Markov chain</p></li>
<li><p><strong>start_date</strong> – datetime
the starting date</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the generated diarySeries</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas DataFrame</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-skmob.models.gravity">
<span id="gravity"></span><h2>Gravity<a class="headerlink" href="#module-skmob.models.gravity" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="skmob.models.gravity.Gravity">
<em class="property">class </em><code class="sig-prename descclassname">skmob.models.gravity.</code><code class="sig-name descname">Gravity</code><span class="sig-paren">(</span><em class="sig-param">deterrence_func_type='power_law', deterrence_func_args=[-2.0], origin_exp=1.0, destination_exp=1.0, gravity_type='singly constrained', name='Gravity model'</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.gravity.Gravity" title="Permalink to this definition">¶</a></dt>
<dd><p>Gravity model.</p>
<p>The Gravity model of human migration. In its original formulation, the probability <span class="math notranslate nohighlight">\(T_{ij}\)</span> of moving from a location <span class="math notranslate nohighlight">\(i\)</span> to location <span class="math notranslate nohighlight">\(j\)</span> is defined as <a class="reference internal" href="#z1946" id="id16"><span>[Z1946]</span></a>:</p>
<div class="math notranslate nohighlight">
\[T_{ij} \propto \frac{P_i P_j}{r_{ij}}\]</div>
<p>where <span class="math notranslate nohighlight">\(P_i\)</span> and <span class="math notranslate nohighlight">\(P_j\)</span> are the population of location <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> and <span class="math notranslate nohighlight">\(r_{ij}\)</span> is the distance between <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>deterrence_func_type</strong> (<em>str, optional</em>) – the deterrence function to use. The possible deterrence function are “power_law” and “exponential”. The default is “power_law”.</p></li>
<li><p><strong>deterrence_func_args</strong> (<em>list, optional</em>) – the arguments of the deterrence function. The default is [-2.0].</p></li>
<li><p><strong>origin_exp</strong> (<em>float, optional</em>) – the exponent of the origin’s relevance (only relevant to globally-constrained model). The default is <cite>1.0</cite>.</p></li>
<li><p><strong>destination_exp</strong> (<em>float, optional</em>) – the explonent of the destination’s relevance. The default is 1.0.</p></li>
<li><p><strong>gravity_type</strong> (<em>str, optional</em>) – the type of gravity model. Possible values are “singly constrained” and “globally constrained”. The default is “singly constrained”.</p></li>
<li><p><strong>name</strong> (<em>str, optional</em>) – the name of the instantiation of the Gravity model. The default is “Gravity model”.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">skmob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.utils</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">constants</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">skmob.models</span> <span class="kn">import</span> <span class="n">Gravity</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load a spatial tessellation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_tess</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/scikit-mobility/scikit-mobility/master/tutorial/data/NY_counties_2011.geojson&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url_tess</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tile_id&#39;</span><span class="p">:</span> <span class="s1">&#39;tile_ID&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tessellation</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  tile_ID  population                                           geometry</span>
<span class="go">0   36019       81716  POLYGON ((-74.006668 44.886017, -74.027389 44....</span>
<span class="go">1   36101       99145  POLYGON ((-77.099754 42.274215, -77.0996569999...</span>
<span class="go">2   36107       50872  POLYGON ((-76.25014899999999 42.296676, -76.24...</span>
<span class="go">3   36059     1346176  POLYGON ((-73.707662 40.727831, -73.700272 40....</span>
<span class="go">4   36011       79693  POLYGON ((-76.279067 42.785866, -76.2753479999...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># load real flows into a FlowDataFrame</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># download the file with the real fluxes from: https://raw.githubusercontent.com/scikit-mobility/scikit-mobility/master/tutorial/data/NY_commuting_flows_2011.csv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fdf</span> <span class="o">=</span> <span class="n">skmob</span><span class="o">.</span><span class="n">FlowDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;NY_commuting_flows_2011.csv&quot;</span><span class="p">,</span> <span class="n">tessellation</span><span class="o">=</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">tile_id</span><span class="o">=</span><span class="s1">&#39;tile_ID&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">     flow origin destination</span>
<span class="go">0  121606  36001       36001</span>
<span class="go">1       5  36001       36005</span>
<span class="go">2      29  36001       36007</span>
<span class="go">3      11  36001       36017</span>
<span class="go">4      30  36001       36019</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># compute the total outflows from each location of the tessellation (excluding self loops)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tot_outflows</span> <span class="o">=</span> <span class="n">fdf</span><span class="p">[</span><span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">fdf</span><span class="p">[</span><span class="s1">&#39;destination&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tessellation</span><span class="p">[</span><span class="n">skmob</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">TOT_OUTFLOW</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot_outflows</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tessellation</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  tile_id  population                                           geometry      0   36019       81716  POLYGON ((-74.006668 44.886017, -74.027389 44....</span>
<span class="go">1   36101       99145  POLYGON ((-77.099754 42.274215, -77.0996569999...</span>
<span class="go">2   36107       50872  POLYGON ((-76.25014899999999 42.296676, -76.24...</span>
<span class="go">3   36059     1346176  POLYGON ((-73.707662 40.727831, -73.700272 40....</span>
<span class="go">4   36011       79693  POLYGON ((-76.279067 42.785866, -76.2753479999...</span>
<span class="go">   tot_outflow</span>
<span class="go">0        29981</span>
<span class="go">1         5319</span>
<span class="go">2       295916</span>
<span class="go">3         8665</span>
<span class="go">4         8871</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># instantiate a singly constrained Gravity model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gravity_singly</span> <span class="o">=</span> <span class="n">Gravity</span><span class="p">(</span><span class="n">gravity_type</span><span class="o">=</span><span class="s1">&#39;singly constrained&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gravity_singly</span><span class="p">)</span>
<span class="go">Gravity(name=&quot;Gravity model&quot;, deterrence_func_type=&quot;power_law&quot;, deterrence_func_args=[-2.0], origin_exp=1.0, destination_exp=1.0, gravity_type=&quot;singly constrained&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">synth_fdf</span> <span class="o">=</span> <span class="n">gravity_singly</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">tessellation</span><span class="p">,</span>
<span class="go">                                   tile_id_column=&#39;tile_ID&#39;,</span>
<span class="go">                                   tot_outflows_column=&#39;tot_outflow&#39;,</span>
<span class="go">                                   relevance_column= &#39;population&#39;,</span>
<span class="go">                                   out_format=&#39;flows&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">synth_fdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  origin destination  flow</span>
<span class="go">0  36019       36101   101</span>
<span class="go">1  36019       36107    66</span>
<span class="go">2  36019       36059  1041</span>
<span class="go">3  36019       36011   151</span>
<span class="go">4  36019       36123    33</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># fit the parameters of the Gravity model from real fluxes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gravity_singly_fitted</span> <span class="o">=</span> <span class="n">Gravity</span><span class="p">(</span><span class="n">gravity_type</span><span class="o">=</span><span class="s1">&#39;singly constrained&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gravity_singly_fitted</span><span class="p">)</span>
<span class="go">Gravity(name=&quot;Gravity model&quot;, deterrence_func_type=&quot;power_law&quot;, deterrence_func_args=[-2.0], origin_exp=1.0, destination_exp=1.0, gravity_type=&quot;singly constrained&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gravity_singly_fitted</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fdf</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gravity_singly_fitted</span><span class="p">)</span>
<span class="go">Gravity(name=&quot;Gravity model&quot;, deterrence_func_type=&quot;power_law&quot;, deterrence_func_args=[-1.9947152031914186], origin_exp=1.0, destination_exp=0.6471759552223144, gravity_type=&quot;singly constrained&quot;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">synth_fdf_fitted</span> <span class="o">=</span> <span class="n">gravity_singly_fitted</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">tile_id_column</span><span class="o">=</span><span class="s1">&#39;tile_ID&#39;</span><span class="p">,</span> <span class="n">tot_outflows_column</span><span class="o">=</span><span class="s1">&#39;tot_outflow&#39;</span><span class="p">,</span> <span class="n">relevance_column</span><span class="o">=</span> <span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="n">out_format</span><span class="o">=</span><span class="s1">&#39;flows&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">synth_fdf_fitted</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="go">  origin destination  flow</span>
<span class="go">0  36019       36101   102</span>
<span class="go">1  36019       36107    66</span>
<span class="go">2  36019       36059  1044</span>
<span class="go">3  36019       36011   152</span>
<span class="go">4  36019       36123    33</span>
</pre></div>
</div>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="z1946"><span class="brackets"><a class="fn-backref" href="#id16">Z1946</a></span></dt>
<dd><p>Zipf, G. K. (1946) The P 1 P 2/D hypothesis: on the intercity movement of persons. American sociological review 11(6), 677-686, <a class="reference external" href="https://www.jstor.org/stable/2087063?seq=1#metadata_info_tab_contents">https://www.jstor.org/stable/2087063?seq=1#metadata_info_tab_contents</a></p>
</dd>
<dt class="label" id="w1971"><span class="brackets">W1971</span></dt>
<dd><p>Wilson, A. G. (1971) A family of spatial interaction models, and associated developments. Environment and Planning A 3(1), 1-32, <a class="reference external" href="https://econpapers.repec.org/article/pioenvira/v_3a3_3ay_3a1971_3ai_3a1_3ap_3a1-32.htm">https://econpapers.repec.org/article/pioenvira/v_3a3_3ay_3a1971_3ai_3a1_3ap_3a1-32.htm</a></p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Radiation</span></code></p>
</div>
<dl class="method">
<dt id="skmob.models.gravity.Gravity.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param">flow_df</em>, <em class="sig-param">relevance_column='relevance'</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.gravity.Gravity.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the parameters of the Gravity model to the flows provided in input, using a Generalized Linear Model (GLM) with a Poisson regression <a class="reference internal" href="#fm1982" id="id17"><span>[FM1982]</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flow_df</strong> (<em>FlowDataFrame</em>) – the real flows on the spatial tessellation.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the column in the spatial tessellation with the relevance of the location. The default is constants.RELEVANCE.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="fm1982"><span class="brackets"><a class="fn-backref" href="#id17">FM1982</a></span></dt>
<dd><p>Flowerdew, R. &amp; Murray, A. (1982) A method of fitting the gravity model based on the Poisson distribution. Journal of regional science 22(2), 191-202, <a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-9787.1982.tb00744.x">https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-9787.1982.tb00744.x</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="skmob.models.gravity.Gravity.generate">
<code class="sig-name descname">generate</code><span class="sig-paren">(</span><em class="sig-param">spatial_tessellation</em>, <em class="sig-param">tile_id_column='tile_ID'</em>, <em class="sig-param">tot_outflows_column='tot_outflow'</em>, <em class="sig-param">relevance_column='relevance'</em>, <em class="sig-param">out_format='flows'</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.gravity.Gravity.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of the Gravity model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spatial_tessellation</strong> (<em>GeoDataFrame</em>) – the spatial tessellation on which to run the simulation.</p></li>
<li><p><strong>tile_id_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> of the location identifier. The default is <cite>constants.TILE_ID</cite>.</p></li>
<li><p><strong>tot_outflows_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> with the outflow of the location. The default is <cite>constants.TOT_OUTFLOW</cite>.</p></li>
<li><p><strong>relevance_column</strong> (<em>str, optional</em>) – the column in <cite>spatial_tessellation</cite> with the relevance of the location. The default is <cite>constants.RELEVANCE</cite>.</p></li>
<li><p><strong>out_format</strong> (<em>str, optional</em>) – the format of the generated flows. Possible values are “flows” and “probabilities”. The default is “flows”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the flows generated by the Gravity model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="data_structures.html#skmob.core.flowdataframe.FlowDataFrame" title="skmob.core.flowdataframe.FlowDataFrame">FlowDataFrame</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-skmob.models.radiation">
<span id="radiation"></span><h2>Radiation<a class="headerlink" href="#module-skmob.models.radiation" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="skmob.models.radiation.Radiation">
<em class="property">class </em><code class="sig-prename descclassname">skmob.models.radiation.</code><code class="sig-name descname">Radiation</code><span class="sig-paren">(</span><em class="sig-param">name='Radiation model'</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.radiation.Radiation" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>The radiation model for human migration.</p>
<dl class="field-list simple">
<dt class="field-odd">param name</dt>
<dd class="field-odd"><p>str
the name of the instantiation of the radiation model</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">ivar name</dt>
<dd class="field-odd"><p>str
the name of the instantiation of the model
default: “Radiation model”</p>
</dd>
<dt class="field-even">ivar <a href="#id22"><span class="problematic" id="id23">edges_</span></a></dt>
<dd class="field-even"><p>pandas DataFrame
the generated edges (flows or probabilities)</p>
</dd>
</dl>
<p>The radiation model describes the flows of people between different locations.
In particular, the fundamental equation of the radiation model gives the average
flux between two counties:
.. math:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">T_</span><span class="p">{</span><span class="n">ij</span><span class="p">}</span><span class="o">&gt;</span> <span class="o">=</span>
</pre></div>
</div>
</div></blockquote>
<p>rac{m_i n_j}{(m_i + s_{ij})(m_i + n_j + s_{ij})}</p>
<blockquote>
<div><p>where where :math:T_{ij} is the total number of commuters from county :math:i, :math:m_i and :math:n_j
are the population in county :math:i and :math:j respectively, and :math:s_{ij} is the total population
in the circle centered at :math:i and touching :math:j excluding the source and the destination population.</p>
<dl class="footnote brackets">
<dt class="label" id="id18"><span class="brackets">1</span></dt>
<dd><p>Simini, Filippo, Gonzalez, Marta C., Maritan, Amos and Barabasi, Albert-Laszlo.</p>
</dd>
</dl>
<p>“A universal model for mobility and migration patterns.”
Nature 484 , no. 7392 (2012): 96–100.</p>
<dl class="footnote brackets">
<dt class="label" id="id19"><span class="brackets">2</span></dt>
<dd><p><a class="reference external" href="https://en.wikipedia.org/wiki/Radiation_law_for_human_mobility">https://en.wikipedia.org/wiki/Radiation_law_for_human_mobility</a></p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">locations_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../datasets/city_fluxes_US.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;population&#39;</span><span class="p">:</span> <span class="s1">&#39;relevance&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">locations_info</span> <span class="o">=</span> <span class="n">locations_info</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">locations_info</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radiation</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="s2">&quot;my first radiation&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radiation</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">(</span><span class="n">locations_info</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;radiation_OD_trips_cities.csv&#39;</span><span class="p">,</span> <span class="n">filter_threshold</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="go">Processing location 385 of 385...</span>
<span class="go">Done.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radiation</span><span class="o">.</span><span class="n">flows_</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">origin  destination flows_average</span>
<span class="go">0       304         67327.0</span>
<span class="go">1       374         34105.0</span>
<span class="go">2       230         16413.0</span>
<span class="go">3       213         15943.0</span>
<span class="go">4       49          3560.0</span>
</pre></div>
</div>
</div></blockquote>
<dl class="method">
<dt id="skmob.models.radiation.Radiation.generate">
<code class="sig-name descname">generate</code><span class="sig-paren">(</span><em class="sig-param">spatial_tessellation</em>, <em class="sig-param">tile_id_column='tile_ID'</em>, <em class="sig-param">tot_outflows_column='tot_outflow'</em>, <em class="sig-param">relevance_column='relevance'</em>, <em class="sig-param">out_format='flows_average'</em><span class="sig-paren">)</span><a class="headerlink" href="#skmob.models.radiation.Radiation.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation of the Radiation model.</p>
<dl class="simple">
<dt>:param spatial_tessellation<span class="classifier">GeoDataFrame</span></dt><dd><p>a pandas DataFrame containing the information about the spatial tessellation
to use. It must contain the following columns:
- “id”: str, name or identifier of the location
- “lat”: float, l_edges_atitude of the location’s centroid
- “lon”: float, longitude of the location’s centroid
- “relevance”: float, number of opportunities at the location (e.g., population or total number of visits).</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>out_format</strong> – {“flows_sample”, “flows_average”, “probs”}
the type of edges to be generated. Three possible values:
- “flows_sample” : the number of migrations generation by a single execution of the model
-    “flows_average” : the average number of migrations between two locations
- “probs” : the probability of movement between two locations
default : “flows_average”</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="io.html" class="btn btn-neutral float-right" title="Input/Output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="evaluation_measures.html" class="btn btn-neutral float-left" title="Evaluation measures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, skmob devs

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>